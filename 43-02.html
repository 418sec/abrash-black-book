<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta name="vsisbn" content="1576101746" />
  <meta name="vstitle" content="Michael Abrash's Graphics Programming Black Book, Special Edition" />
  <meta name="vsauthor" content="Michael Abrash" />
  <meta name="vspublisher" content="The Coriolis Group" />
  <meta name="vspubdate" content="07/01/97" />
  <meta name="vscategory" content="Web and Software Development: Game Development,Web and Software Development: Graphics and Multimedia Development" />

  <title>Michael Abrash's Graphics Programming Black Book Special Edition: Bit-Plane Animation</title>
  <meta name="chapter" content="43" />
  <meta name="pages" content="799-801" />
</head>

<body>
  <center>
    <table border="1">
      <tr>
        <td><a href="43-01.html">Previous</a></td>

        <td><a href="index.html">Table of Contents</a></td>

        <td><a href="43-03.html">Next</a></td>
      </tr>
    </table>
  </center>

  <p><br /></p>

  <h4 align="left" id="Heading4">Stacking the Palette Registers</h4>

  <p>Suppose that instead of viewing the four bits per pixel coming out of display memory as selecting one of sixteen colors,we view those bits as selecting one of <i>four</i> colors. If the bit from plane 0 is 1, that would select color 0 (say, red). The bit from plane 1 would select color 1 (say, green), the bit from plane 2 would select color 2 (say, blue), and the bit from plane 3 would select color 3 (say, white). Whenever more than 1 bit is 1, the 1 bit from the lowest-numbered plane would determine the color, and 1 bits from all other planes would be ignored. Finally, the absence of any 1 bits at all would select the background color (say, black).</p>

  <p>That would give us four colors and the background color. It would also give us nifty image precedence, with images in plane 0 appearing to be in front of images from the other planes, images in plane 1 appearing to be in front of images from planes 2 and 3, and so on. It would even give us transparency, where rearward images would show through holes within and around the edges of images in forward planes. Finally, and most importantly, it would meet all the criteria needed to allow us to store each image in a single plane, letting us manipulate the images very quickly and with no reprogramming of the VGA&rsquo;s hardware other than the few <b>OUT</b> instructions required to select the plane we want to write to.</p>

  <p>Which leaves only one question: How do we get this magical pixel-precedence scheme to work? As it turns out, all we need to do is reprogram the palette registers so that the 1 bit from the plane with the highest precedence determines the color. The palette RAM settings for the colors described above are summarized in Table 43.1.</p>

  <p>Remember that the 4-bit values coming from display memory select which palette register provides the actual pixel color. Given that, it&rsquo;s easy to see that the rightmost 1-bit of the four bits coming from display memory in Table 43.1 selects the pixel color. If the bit from plane 0 is 1, then the color is red, no matter what the other bits are, as shown in Figure 43.4. If the bit from plane 0 is 0, then if the bit from plane 1 is 1 the color is green, and so on for planes 2 and 3. In other words, with the palette register settings we instantly have exactly what we want, which is an approach that keeps images in one plane from interfering with images in other planes while providing precedence and transparency.</p>

  <table width="100%">
    <tr>
      <th colspan="3">
        <hr />
      </th>
    </tr>

    <tr>
      <th valign="bottom" align="left" width="15%">Bit Value For Plane<br />
      3 2 1 0</th>

      <th valign="bottom" align="left" width="25%">Palette Register</th>

      <th valign="bottom" align="left" width="60%">Register setting</th>
    </tr>

    <tr>
      <th colspan="3">
        <hr />
      </th>
    </tr>

    <tr>
      <td valign="top" align="left">0 0 0 0</td>

      <td valign="top" align="left">0</td>

      <td valign="top" align="left">00H (black)</td>
    </tr>

    <tr>
      <td valign="top" align="left">0 0 0 1</td>

      <td valign="top" align="left">1</td>

      <td valign="top" align="left">3CH (red)</td>
    </tr>

    <tr>
      <td valign="top" align="left">0 0 1 0</td>

      <td valign="top" align="left">2</td>

      <td valign="top" align="left">3AH (green)</td>
    </tr>

    <tr>
      <td valign="top" align="left">0 0 1 1</td>

      <td valign="top" align="left">3</td>

      <td valign="top" align="left">3CH (red)</td>
    </tr>

    <tr>
      <td valign="top" align="left">0 1 0 0</td>

      <td valign="top" align="left">4</td>

      <td valign="top" align="left">39H (blue)</td>
    </tr>

    <tr>
      <td valign="top" align="left">0 1 0 1</td>

      <td valign="top" align="left">5</td>

      <td valign="top" align="left">3CH (red)</td>
    </tr>

    <tr>
      <td valign="top" align="left">0 1 1 0</td>

      <td valign="top" align="left">6</td>

      <td valign="top" align="left">3AH (green)</td>
    </tr>

    <tr>
      <td valign="top" align="left">0 1 1 1</td>

      <td valign="top" align="left">7</td>

      <td valign="top" align="left">3CH (red)</td>
    </tr>

    <tr>
      <td valign="top" align="left">1 0 0 0</td>

      <td valign="top" align="left">8</td>

      <td valign="top" align="left">3FH (white)</td>
    </tr>

    <tr>
      <td valign="top" align="left">1 0 0 1</td>

      <td valign="top" align="left">9</td>

      <td valign="top" align="left">3CH (red)</td>
    </tr>

    <tr>
      <td valign="top" align="left">1 0 1 0</td>

      <td valign="top" align="left">10</td>

      <td valign="top" align="left">3AH (green)</td>
    </tr>

    <tr>
      <td valign="top" align="left">1 0 1 1</td>

      <td valign="top" align="left">11</td>

      <td valign="top" align="left">3CH (red)</td>
    </tr>

    <tr>
      <td valign="top" align="left">1 1 0 0</td>

      <td valign="top" align="left">12</td>

      <td valign="top" align="left">39H (blue)</td>
    </tr>

    <tr>
      <td valign="top" align="left">1 1 0 1</td>

      <td valign="top" align="left">13</td>

      <td valign="top" align="left">3CH (red)</td>
    </tr>

    <tr>
      <td valign="top" align="left">1 1 1 0</td>

      <td valign="top" align="left">14</td>

      <td valign="top" align="left">3AH (green)</td>
    </tr>

    <tr>
      <td valign="top" align="left">1 1 1 1</td>

      <td valign="top" align="left">15</td>

      <td valign="top" align="left">3CH (red)</td>
    </tr>

    <tr>
      <th colspan="3">
        <hr />
      </th>
    </tr>

    <tr>
      <th caption="" align="left" colspan="3">Table 43.1 Palette RAM settings for bit-plane animation.</th>
    </tr>

    <tr>
      <th colspan="3">
        <hr />
      </th>
    </tr>
  </table>

  <p><a id="Fig4"><img src="images/43-04.jpg" /><br />
  <b>Figure 43.4</b></a>&nbsp;&nbsp;<i>How pixel precedence works.</i></p>

  <p>Seems almost too easy, doesn&rsquo;t it? Nonetheless, it works beautifully, as we&rsquo;ll see very shortly. First, though, I&rsquo;d like to point out that there&rsquo;s nothing sacred about plane 0 having precedence. We could rearrange the palette register settings so that any plane had the highest precedence, followed by the other planes in any order. I&rsquo;ve chosen to make plane 0 the highest precedence only because it seems simplest to think of plane 0 as appearing in front of plane 1, which is in front of plane 2, which is in front of plane 3.</p>

  <h3 id="Heading5">Bit-Plane Animation in Action</h3>

  <p>Without further ado, Listing 43.1 shows bit-plane animation in action. Listing 43.1 animates 13 rather large images (each 32 pixels on a side) over a complex background at a good clip <i>even on a primordial 8088-based PC</i>. Five of the images move very quickly, while the other 8 bounce back and forth at a steady pace.</p>

  <p><br /></p>

  <center>
    <table border="1">
      <tr>
        <td><a href="43-01.html">Previous</a></td>

        <td><a href="index.html">Table of Contents</a></td>

        <td><a href="43-03.html">Next</a></td>
      </tr>
    </table>
  </center>
  <hr width="90%" size="1" noshade="noshade" />

  <div align="center">
    Graphics Programming Black Book &copy; 2001 Michael Abrash
  </div>
</body>
</html>
