<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta name="vsisbn" content="1576101746" />
  <meta name="vstitle" content="Michael Abrash's Graphics Programming Black Book, Special Edition" />
  <meta name="vsauthor" content="Michael Abrash" />
  <meta name="vspublisher" content="The Coriolis Group" />
  <meta name="vspubdate" content="07/01/97" />
  <meta name="vscategory" content="Web and Software Development: Game Development,Web and Software Development: Graphics and Multimedia Development" />

  <title>Michael Abrash's Graphics Programming Black Book Special Edition: Compiling BSP Trees</title>
  <meta name="chapter" content="60" />
  <meta name="pages" content="1115-1119" />
</head>

<body>
  <center>
    <table border="1">
      <tr>
        <td><a href="59-06.html">Previous</a></td>

        <td><a href="index.html">Table of Contents</a></td>

        <td><a href="60-02.html">Next</a></td>
      </tr>
    </table>
  </center>

  <p><br /></p>

  <h2 id="Heading1">Chapter 60<br />
  Compiling BSP Trees</h2>

  <h3 id="Heading2">Taking BSP Trees from Concept to Reality</h3>

  <p>As long-time readers of my columns know, I tend to move my family around the country quite a bit. Change doesn&rsquo;t come out of the blue, so there&rsquo;s some interesting history to every move, but the roots of the latest move go back even farther than usual. To wit:</p>

  <p>In 1986, just after we moved from Pennsylvania to California, I started writing a column for <i>Programmer&rsquo;s Journal</i>. I was paid peanuts for writing it, and I doubt if even 5,000 people saw some of the first issues the columns appeared in, but I had a lot of fun exploring fast graphics for the EGA and VGA.</p>

  <p>By 1991, we were in Vermont, and I was writing the <i>Graphics Programming</i> column for <i>Dr. Dobb&rsquo;s Journal</i> (and having a great time doing it, even though it took all my spare nights and weekends to stay ahead of the deadlines). In those days I received a lot of unsolicited evaluation software, including a PC shareware game called Commander Keen, a side-scrolling game that was every bit as good as the hot Nintendo games of the day. I loved the way the game looked, and actually drafted a column opening about how for years I&rsquo;d been claiming that the PC could be a great game machine in the hands of great programmers, and here, finally, was the proof, in the form of Commander Keen. In the end, though, I decided that would be too close to a product review, an area that I&rsquo;ve observed inflames passions in nonconstructive ways, so I went with a different opening.</p>

  <p>In 1992, I did a series of columns about my X-Sharp 3-D library, and hung out on <i>DDJ</i>&rsquo;s bulletin board. There was another guy who hung out there who knew a lot about 3-D, a fellow named John Carmack who was surely the only game programmer I&rsquo;d ever heard of who developed under NEXTSTEP. When we moved to Redmond, I didn&rsquo;t have time for BBSs anymore, though.</p>

  <p>In early 1993, I hired Chris Hecker. Later that year, Chris showed me an alpha copy of DOOM, and I nearly fell out of my chair. About a year later, Chris forwarded me a newsgroup post about NEXTSTEP, and said, &ldquo;Isn&rsquo;t this the guy you used to know on the <i>DDJ</i> bulletin board?&rdquo; Indeed it was John Carmack; what&rsquo;s more, it turned out that John was the guy who had written DOOM. I sent him a congratulatory piece of mail, and he sent back some thoughts about what he was working on, and somewhere in there I asked if he ever came up my way. It turned out he had family in Seattle, so he stopped in and visited, and we had a great time.</p>

  <p>Over the next year, we exchanged some fascinating mail, and I became steadily more impressed with John&rsquo;s company, id Software. Eventually, John asked if I&rsquo;d be interested in joining id, and after a good bit of consideration I couldn&rsquo;t think of anything else that would be as much fun or teach me as much. The upshot is that here we all are in Dallas, our fourth move of 2,000 miles or more since I&rsquo;ve starting writing in the computer field, and now I&rsquo;m writing some seriously cool 3-D software.</p>

  <p>Now that I&rsquo;m here, it&rsquo;s an eye-opener to look back and see how events fit together over the last decade. You see, when John started doing PC game programming he learned fast graphics programming from those early <i>Programmer&rsquo;s Journal</i> articles of mine. The copy of Commander Keen that validated my faith in the PC as a game machine was the fruit of those articles, for that was an id game (although I didn&rsquo;t know that then). When John was hanging out on the <i>DDJ</i> BBS, he had just done Castle Wolfenstein 3-D, the first great indoor 3-D game, and was thinking about how to do DOOM. (If only I&rsquo;d known that then!) And had I not hired Chris, or had he not somehow remembered me talking about that guy who used NEXTSTEP, I&rsquo;d never have gotten back in touch with John, and things would surely be different. (At the very least, I wouldn&rsquo;t be hearing jokes about how my daughter&rsquo;s going to grow up saying &ldquo;y&rsquo;all&rdquo;.)</p>

  <p>I think there&rsquo;s a worthwhile lesson to be learned from all this, a lesson that I&rsquo;ve seen hold true for many other people, as well. If you do what you love, and do it as well as you can, good things will eventually come of it. Not necessarily quickly or easily, but if you stick with it, they will come. There are threads that run through our lives, and by the time we&rsquo;ve been adults for a while, practically everything that happens has roots that run far back in time. The implication should be clear: If you want good things to happen in your future, stretch yourself and put in the extra effort now at whatever you care passionately about, so those roots will have plenty to work with down the road.</p>

  <p>All this is surprisingly closely related to this chapter&rsquo;s topic, BSP trees, because John is the fellow who brought BSP trees into the spotlight by building DOOM around them. He also got me started with BSP trees by explaining how DOOM worked and getting me interested enough to want to experiment; the BSP compiler in this article is the direct result. Finally, John has been an invaluable help to me as I&rsquo;ve learned about BSP trees, as will become evident when we discuss BSP optimization.</p>

  <p>Onward to compiling BSP trees.</p>

  <h3 id="Heading3">Compiling BSP Trees</h3>

  <p>As you&rsquo;ll recall from the previous chapter, a BSP tree is nothing more than a series of binary subdivisions that partion space into ever-smaller pieces. That&rsquo;s a simple data structure, and a BSP compiler is a correspondingly simple tool. First, it groups all the surfaces (lines in 2-D, or polygons in 3-D) together into a single subspace that encompasses the entire world of the database. Then, it chooses one of the surfaces as the root node, and uses its line or plane to divide the remaining surfaces into two subspaces, splitting surfaces into two parts if they cross the line or plane of the root. Each of the two resultant subspaces is then processed in the same fashion, and so on, recursively, until the point is reached where all surfaces have been assigned to nodes, and each leaf surface subdivides a subspace that is empty except for that surface. Put another way, the root node carves space into two parts, and the root&rsquo;s children carve each of those parts into two more parts, and so on, with each surface carving ever smaller subspaces, until all surfaces have been used. (Actually, there are many other lines or planes that a BSP tree can use to carve up space, but this is the approach we&rsquo;ll use in the current discussion.)</p>

  <p><br /></p>

  <center>
    <table border="1">
      <tr>
        <td><a href="59-06.html">Previous</a></td>

        <td><a href="index.html">Table of Contents</a></td>

        <td><a href="60-02.html">Next</a></td>
      </tr>
    </table>
  </center>
  <hr width="90%" size="1" noshade="noshade" />

  <div align="center">
    Graphics Programming Black Book &copy; 2001 Michael Abrash
  </div>
</body>
</html>
