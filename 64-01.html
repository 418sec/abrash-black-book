<HTML>
<HEAD>
<META name=vsisbn content="1576101746">
<META name=vstitle content="Michael Abrash's Graphics Programming Black Book, Special Edition">
<META name=vsauthor content="Michael Abrash">
<META name=vspublisher content="The Coriolis Group">
<META name=vspubdate content="07/01/97">
<META name=vscategory content="Web and Software Development: Game Development,Web and Software Development: Graphics and Multimedia Development">






<TITLE>Michael Abrash's Graphics Programming Black Book Special Edition: Quake's Visible-Surface Determination</TITLE>

<!-- HEADER -->
<!-- Empty Reference Subhead -->

<!--ISBN=1576101746//-->
<!--TITLE=Michael Abrash's Graphics Programming Black Book Special Edition//-->
<!--AUTHOR=Michael Abrash//-->
<!--PUBLISHER=The Coriolis Group, Inc.//-->
<!--CHAPTER=64//-->
<!--PAGES=1177-1181//-->
<!--UNASSIGNED1//-->
<!--UNASSIGNED2//--></HEAD><BODY LINK=#0000FF ALINK=#000099 VLINK=#0000FF BGCOLOR=#FFFFFF>

<CENTER>
<TABLE BORDER>
<TR>
<TD><A HREF="63-04.html">Previous</A></TD>
<TD><A HREF="index.html">Table of Contents</A></TD>
<TD><A HREF="64-02.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>
<P><BR></P>
<H2><A NAME="Heading1"></A><FONT COLOR="#000077">Chapter 64<BR>Quake&rsquo;s Visible-Surface Determination
</FONT></H2>
<H3><A NAME="Heading2"></A><FONT COLOR="#000077">The Challenge of Separating All Things Seen from All Things Unseen</FONT></H3>
<P>Years ago, I was working at Video Seven, a now-vanished video adapter manufacturer, helping to develop a VGA clone. The fellow who was designing Video Seven&rsquo;s VGA chip, Tom Wilson, had worked around the clock for months to make his VGA run as fast as possible, and was confident he had pretty much maxed out its performance. As Tom was putting the finishing touches on his chip design, however, news came fourth-hand that a competitor, Paradise, had juiced up the performance of the clone they were developing by putting in a FIFO.
</P>
<P>That was all he knew; there was no information about what sort of FIFO, or how much it helped, or anything else. Nonetheless, Tom, normally an affable, laid-back sort, took on the wide-awake, haunted look of a man with too much caffeine in him and no answers to show for it, as he tried to figure out, from hopelessly thin information, what Paradise had done. Finally, he concluded that Paradise must have put a write FIFO between the system bus and the VGA, so that when the CPU wrote to video memory, the write immediately went into the FIFO, allowing the CPU to keep on processing instead of stalling each time it wrote to display memory.</P>
<P>Tom couldn&rsquo;t spare the gates or the time to do a full FIFO, but he could implement a one-deep FIFO, allowing the CPU to get one write ahead of the VGA. He wasn&rsquo;t sure how well it would work, but it was all he could do, so he put it in and taped out the chip.</P>
<P>The one-deep FIFO turned out to work astonishingly well; for a time, Video Seven&rsquo;s VGAs were the fastest around, a testament to Tom&rsquo;s ingenuity and creativity under pressure. However, the truly remarkable part of this story is that Paradise&rsquo;s FIFO design turned out to bear not the slightest resemblance to Tom&rsquo;s, and <I>didn&rsquo;t work as well.</I> Paradise had stuck a <I>read</I> FIFO between display memory and the video output stage of the VGA, allowing the video output to read ahead, so that when the CPU wanted to access display memory, pixels could come from the FIFO while the CPU was serviced immediately. That did indeed help performance&mdash;but not as much as Tom&rsquo;s write FIFO.</P>
<TABLE WIDTH="100%"><TR>
<TD WIDTH="5%" ALIGN="LEFT" VALIGN="TOP"><IMG SRC="images/i.jpg"><TD WIDTH="90%" VALIGN="TOP" ALIGN="LEFT"><SMALL><I>What we have here is as neat a parable about the nature of creative design as one could hope to find. The scrap of news about Paradise&rsquo;s chip contained almost no actual information, but it forced Tom to push past the limits he had unconsciously set in coming up with his original design. And, in the end, I think that the single most important element of great design, whether it be hardware, software, or any creative endeavor, is precisely what the Paradise news triggered in Tom: the ability to detect the limits you have built into the way you think about your design, and then transcend those limits.</I></SMALL>
</TABLE>
<P>The problem, of course, is how to go about transcending limits you don&rsquo;t even know you&rsquo;ve imposed. There&rsquo;s no formula for success, but two principles can stand you in good stead: simplify and keep on trying new things.
</P>
<P>Generally, if you find your code getting more complex, you&rsquo;re fine-tuning a frozen design, and it&rsquo;s likely you can get more of a speed-up, with less code, by rethinking the design. A really good design should bring with it a moment of immense satisfaction in which everything falls into place, and you&rsquo;re amazed at how little code is needed and how all the boundary cases just work properly.</P>
<P>As for how to rethink the design, do it by pursuing whatever ideas occur to you, no matter how off-the-wall they seem. Many of the truly brilliant design ideas I&rsquo;ve heard of over the years sounded like nonsense at first, because they didn&rsquo;t fit my preconceived view of the world. Often, such ideas are in fact off-the-wall, but just as the news about Paradise&rsquo;s chip sparked Tom&rsquo;s imagination, aggressively pursuing seemingly outlandish ideas can open up new design possibilities for you.</P>
<P>Case in point: The evolution of Quake&rsquo;s 3-D graphics engine.</P>
<H3><A NAME="Heading3"></A><FONT COLOR="#000077">VSD: The Toughest 3-D Challenge of All</FONT></H3>
<P>I&rsquo;ve spent most of my waking hours for the last several months working on Quake, id Software&rsquo;s successor to DOOM, and I suspect I have a few more months to go. The very best things don&rsquo;t happen easily, nor quickly&mdash;but when they happen, all the sweat becomes worthwhile.
</P>
<P>In terms of graphics, Quake is to DOOM as DOOM was to its predecessor, Wolfenstein 3-D. Quake adds true, arbitrary 3-D (you can look up and down, lean, and even fall on your side), detailed lighting and shadows, and 3-D monsters and players in place of DOOM&rsquo;s sprites. Someday I hope to talk about how all that works, but for the here and now I want to talk about what is, in my opinion, the toughest 3-D problem of all: visible surface determination (drawing the proper surface at each pixel), and its close relative, culling (discarding non-visible polygons as quickly as possible, a way of accelerating visible surface determination). In the interests of brevity, I&rsquo;ll use the abbreviation VSD to mean both visible surface determination and culling from now on.</P>
<P>Why do I think VSD is the toughest 3-D challenge? Although rasterization issues such as texture mapping are fascinating and important, they are tasks of relatively finite scope, and are being moved into hardware as 3-D accelerators appear; also, they only scale with increases in screen resolution, which are relatively modest.</P>
<P>In contrast, VSD is an open-ended problem, and there are dozens of approaches currently in use. Even more significantly, the performance of VSD, done in an unsophisticated fashion, scales directly with scene complexity, which tends to increase as a square or cube function, so this very rapidly becomes the limiting factor in rendering realistic worlds. I expect VSD to be the increasingly dominant issue in realtime PC 3-D over the next few years, as 3-D worlds become increasingly detailed. Already, a good-sized Quake level contains on the order of 10,000 polygons, about three times as many polygons as a comparable DOOM level.</P><P><BR></P>
<CENTER>
<TABLE BORDER>
<TR>
<TD><A HREF="63-04.html">Previous</A></TD>
<TD><A HREF="index.html">Table of Contents</A></TD>
<TD><A HREF="64-02.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>

<hr width="90%" size="1" noshade>
<div align="center">
<font face="Verdana,sans-serif" size="1">Graphics Programming Black Book &copy; 2001 Michael Abrash</font>
</div>
<!-- all of the reference materials (books) have the footer and subfoot reveresed -->
<!-- reference_subfoot = footer -->
<!-- reference_footer = subfoot -->

<!-- BEGIN SUB FOOTER -->
</BODY>
</HTML>

<!-- END FOOTER -->


